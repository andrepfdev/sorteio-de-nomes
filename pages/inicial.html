<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sorteio de Nomes Online</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css" rel="stylesheet">
</head>
<body class="bg-light">
    <div class="container py-5">
        <h1 class="text-center mb-4">Sorteador de Nomes</h1>

        <div class="mb-3">
            <label for="fileUpload" class="form-label">Carregar Arquivo (CSV ou TXT):</label>
            <div class="input-group">
                <input class="form-control" type="file" id="fileUpload" accept=".csv,.txt">
                <span id="fileInfo" class="input-group-text">Nenhum arquivo selecionado</span>
            </div>
        </div>

        <div class="mb-3">
            <label for="namesInput" class="form-label">Nomes (um por linha ou separados por v√≠rgula):</label>
            <textarea id="namesInput" class="form-control" rows="5" placeholder="Digite os nomes aqui"></textarea>
        </div>

        <div class="mb-3">
            <label for="drawCount" class="form-label">Quantidade de nomes a sortear:</label>
            <input id="drawCount" type="number" class="form-control w-25" min="1" value="1">
        </div>

        <div class="d-flex justify-content-center gap-2">
            <button id="drawButton" class="btn btn-primary">Sortear</button>
            <button id="clearButton" class="btn btn-danger">Limpar Nomes</button>
        </div>

        <div id="resultArea" class="mt-4 row g-3"></div>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        $(document).ready(function() {
            function processFile(file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const content = e.target.result;
                    let names;
                    if (file.name.endsWith('.csv')) {
                        names = content.split(/\r?\n/)
                            .map(line => line.split(',').map(name => name.trim()))
                            .flat()
                            .filter(name => name !== '');
                    } else {
                        names = content.split(/\r?\n/)
                            .map(name => name.trim())
                            .filter(name => name !== '');
                    }
                    $('#namesInput').val(names.join('\n'));
                    $('#fileInfo').text(`${file.name} - ${names.length} nomes carregados`);
                };
                reader.readAsText(file);
            }

            $('#fileUpload').on('change', function(e) {
                const file = e.target.files[0];
                if (file) {
                    const validExtensions = ['csv', 'txt'];
                    const fileExtension = file.name.split('.').pop().toLowerCase();
                    if (validExtensions.includes(fileExtension)) {
                        processFile(file);
                    } else {
                        alert('Por favor, selecione apenas arquivos CSV ou TXT');
                        this.value = '';
                        $('#fileInfo').text('Nenhum arquivo selecionado');
                    }
                }
            });

            $('#clearButton').on('click', function() {
                $('#namesInput').val('');
                $('#fileUpload').val('');
                $('#fileInfo').text('Nenhum arquivo selecionado');
                $('#resultArea').empty();
            });

            $('#drawButton').on('click', function() {
                $('#resultArea').empty();
                let namesInput = $('#namesInput').val();
                let names = namesInput.includes(',') 
                    ? namesInput.split(',').map(name => name.trim())
                    : namesInput.split('\n').map(name => name.trim());
                names = names.filter(name => name !== '');
                if (names.length === 0) {
                    alert('Por favor, insira alguns nomes!');
                    return;
                }
                let drawCount = parseInt($('#drawCount').val());
                drawCount = Math.min(drawCount, names.length);

                function drawUniqueNames(names, count) {
                    let shuffled = names.slice();
                    for (let i = shuffled.length - 1; i > 0; i--) {
                        const j = Math.floor(Math.random() * (i + 1));
                        [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
                    }
                    return shuffled.slice(0, count);
                }

                let drawnNames = drawUniqueNames(names, drawCount);
                drawnNames.forEach((name, index) => {
                    setTimeout(() => {
                        let nameElement = $('<div>')
                            .addClass('col-auto p-2 bg-success text-white text-center rounded')
                            .text(name);
                        $('#resultArea').append(nameElement);
                    }, index * 500);
                });
            });
        });
    </script>
</body>
</html>
